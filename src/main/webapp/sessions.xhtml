<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
    <title>Dashboard</title>

    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.0/dist/tailwind.min.css" rel="stylesheet"/>

    <!-- Flowbite CSS -->
    <link href="https://cdn.jsdelivr.net/npm/flowbite@1.6.0/dist/flowbite.min.css" rel="stylesheet"/>
</h:head>
<body class="bg-gray-50 min-h-screen ">

<header class="flex items-center justify-between p-4 bg-white shadow-md">
    <div class="flex items-center space-x-4">
        <img src="path/to/logo.png" alt="Logo" class="h-10"/>
    </div>
    <!-- User Icon -->
    <div class="flex items-center space-x-4">
        <img src="css/profil.png" alt="User Icon" class="h-10 w-10 rounded-full border border-gray-300"/>
    </div>
</header>

<button id="openModalBtn" class="absolute top-8 right-3 mt-4  bg-blue-900 text-white py-2 px-4 rounded-full shadow-lg hover:bg-white hover:text-gray-900 transition duration-200 flex items-center" >
    <span class="mr-2">+</span> Ajouter une nouvelle session
</button>



<!-- Modal - Form -->
<div id="sessionModal" class="hidden fixed inset-0 bg-gray-500 bg-opacity-50 flex justify-center items-center z-50">
    <div class="w-full max-w-2xl bg-white shadow-lg rounded-lg p-8 relative">
        <!-- Close Button in Top-Right Corner -->
        <button id="closeModalBtn" class="absolute top-4 right-3 mr-4 text-gray-500 hover:text-gray-700 text-xl font-bold">
            X
        </button>

        <h1 class="text-3xl font-semibold text-gray-800 mb-6">Créer une nouvelle session</h1>

        <h:form>
            <!-- Dropdown for Type -->
            <div class="mb-6">
                <h:outputLabel for="type" value="Type de session:"  class="block text-sm font-medium text-gray-700 mb-2"/>
                <h:selectOneMenu id="type" value="#{sessionBean.type}" styleClass="block w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-700 focus:ring-blue-800 focus:border-blue-800">
                    <f:selectItem itemValue="" itemLabel="-- Sélectionner le type --"/>
                    <f:selectItem itemValue="Normal d'hiver" itemLabel="Normal d'hiver"/>
                    <f:selectItem itemValue="Normal de printemps" itemLabel="Normal de printemps"/>
                    <f:selectItem itemValue="Rattrapage d'hiver" itemLabel="Rattrapage d'hiver"/>
                    <f:selectItem itemValue="Rattrapage de printemps" itemLabel="Rattrapage de printemps"/>
                </h:selectOneMenu>

            </div>

            <!-- Start Date -->
            <div class="mb-6">
                <h:outputLabel for="startDate" value="Date de début:" class="block text-sm font-medium text-gray-700 mb-2"/>
                <div class="relative">
                    <h:inputText id="startDate" value="#{sessionBean.startDate}"  type="date"
                                 styleClass="block w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-700 focus:ring-blue-800 focus:border-blue-800"/>
                </div>
            </div>

            <!-- End Date -->
            <div class="mb-6">
                <h:outputLabel for="endDate" value="Date de fin:" class="block text-sm font-medium text-gray-700 mb-2"/>
                <div class="relative">
                    <h:inputText id="endDate" value="#{sessionBean.endDate}" type="date"
                                 styleClass="block w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-700 focus:ring-blue-800 focus:border-blue-800"/>
                </div>
            </div>

            <!-- Save Button -->
            <div class="mt-6">
                <h:commandButton value="Enregistrer la session" action="#{sessionBean.saveSession}"
                                 styleClass="w-full bg-blue-900 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition duration-200"/>
            </div>

            <h:messages globalOnly="true"
                        styleClass="mt-4 text-sm"
                        infoClass="text-green-500"
                        errorClass="text-red-500"
                        fatalClass="text-red-700"
                        warnClass="text-yellow-500"/>
        </h:form>
    </div>
</div>


<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="hidden fixed inset-0 bg-gray-500 bg-opacity-50 flex justify-center items-center z-50">
    <div class="w-full max-w-md bg-white shadow-lg rounded-lg p-6 relative">
        <!-- Close Button -->
        <button id="closeDeleteModalBtn" class="absolute top-4 right-3 mr-4 text-gray-500 hover:text-gray-700 text-xl font-bold" onclick="closeDeleteModal();">
            X
        </button>

        <!-- Modal Content -->
        <h2 class="text-xl font-semibold text-gray-800 mb-4 mt-4">Confirmer la suppression</h2>
        <p class="text-gray-600 mb-6">Êtes-vous sûr de vouloir supprimer cette session ? Cette action ne peut pas être annulée.</p>

        <!-- Action Buttons -->
        <div class="flex justify-end space-x-4">
            <button class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400" onclick="closeDeleteModal();">
                Annuler
            </button>
            <h:form>
                <h:commandButton value="Confirmer" action="#{sessionBean.deleteSession(sessionBean.selectedSession)}"
                                 styleClass="bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700">
                </h:commandButton>
            </h:form>
        </div>
    </div>
</div>


<br/>


<div class="container mx-auto mt-8 px-4">
    <h2 class="text-2xl font-bold text-gray-800 mt-8 mb-4">
        Sessions (#{sessionBean.sessions.size()})
    </h2>
    <h:dataTable value="#{sessionBean.sessions}" var="element"
                 styleClass="table-auto border-collapse w-full text-left bg-white shadow-md rounded-lg">
        <h:column>
            <f:facet name="header">Type</f:facet>
            #{element.type}
        </h:column>
        <h:column>
            <f:facet name="header">Date de début</f:facet>
            #{element.startDate}
        </h:column>
        <h:column>
            <f:facet name="header">Date de fin</f:facet>
            #{element.endDate}
        </h:column>
        <h:column>
            <h:form>
                <div style="display: flex; gap: 24px; align-items: center;">
                    <h:commandLink action="#{sessionBean.goToSessionDashboard(element.session_id)}"
                                   styleClass="text-blue-600 hover:text-blue-800">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25a2.25 2.25 0 00-2.25-2.25H5.25a2.25 2.25 0 00-2.25 2.25v9a2.25 2.25 0 002.25 2.25H9M10.5 6.75l6 6m0 0l-6 6m6-6H9" />
                        </svg>
                    </h:commandLink>

                    <h:commandLink action="#{sessionBean.loadSelectedSession(element)}"
                                   styleClass="text-red-600 hover:text-red-800">
                        <!-- Trash Can Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 3h6M5 7h14M10 11v6m4-6v6M5 7l1 14h12l1-14H5z" />
                        </svg>
                        <f:ajax execute="@this" render="@none" onevent="handleDeleteButtonClick" />
                    </h:commandLink>
                </div>
            </h:form>



        </h:column>
    </h:dataTable>
</div>



<!-- Flowbite and Tailwind JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/flowbite@1.6.0/dist/flowbite.min.js"></script>

<script>

    // Open Modal
    document.getElementById('openModalBtn').addEventListener('click', function() {
        document.getElementById('sessionModal').classList.remove('hidden');
        localStorage.setItem('isModalOpen', 'true'); // Store the modal state
    });

    // Close Modal
    document.getElementById('closeModalBtn').addEventListener('click', function() {
        document.getElementById('sessionModal').classList.add('hidden');
        localStorage.removeItem('isModalOpen'); // Clear the modal state
    });

    // Check the modal state on page load
    window.addEventListener('DOMContentLoaded', (event) => {
        if (localStorage.getItem('isModalOpen') === 'true') {
            document.getElementById('sessionModal').classList.remove('hidden');
        }
    });

    function handleDeleteButtonClick(event) {
        if (event.status === "success") {
            openDeleteModal(); // Open the modal after backend processing is successful
        }
    }



    function openDeleteModal() {
        document.getElementById("deleteModal").classList.remove("hidden");
    }

    // Close the Delete Confirmation Modal
    function closeDeleteModal() {
        document.getElementById('deleteModal').classList.add('hidden');
        localStorage.removeItem('sessionIdToDelete'); // Clear sessionId
    }

</script>

</body>
</html>
